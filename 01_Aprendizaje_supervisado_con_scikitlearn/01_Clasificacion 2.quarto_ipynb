{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "f0372892",
   "metadata": {},
   "source": [
    "# Clasificación\n",
    "\n",
    "En este capítulo, se te presentarán los problemas de clasifiación y aprenderás a resolverlos mediante técnicas de aprendizaje supervisado. Aprenderás a dividir los datos en conjuntos de entrenamiento y de prueba, ajustar un modelo, hacer predicciones y evaluar la precisión. Descubrirás la relación entre la complejidad del modelo y el rendimiento, aplicando lo que aprendas a un conjunto de datos de rotación, donde clasificarás el estado de rotación de los clientes de una empresa de telecomunicaciones.\n",
    "\n",
    "## Machine learning con scikit-learn\n",
    "\n",
    "-   ¿Qué es el machine learning?\n",
    "\n",
    "    -   Es el proceso mediante el cual:\n",
    "        -   Se da a los ordenadores la capacidad de aprender a tomar decisiones a partir de datos.\n",
    "        -   ¡Sin haber sido programados explícitamente!\n",
    "\n",
    "-   Ejemplos de machine learning\n",
    "\n",
    "    -   Clasificación de correos de spam o no en relación al contenido y su remitente.\n",
    "    -   Agrupar libros por categorías en función de las palabras que contiene.\n",
    "\n",
    "-   Aprendizaje no supervisado\n",
    "\n",
    "    -   Descubrir patrones ocultos a partir de datos no etiquetados.\n",
    "    -   Ejemplo\n",
    "        -   Agrupar a los clientes en categorías distintas (agrupación en clústeres)\n",
    "\n",
    "            ![](images/paste-1.png){width=\"83%\"}\n",
    "\n",
    "-   Aprendizaje supervisado\n",
    "\n",
    "    -   Los valores previstos son conocidos.\n",
    "\n",
    "    -   Objetivo: predecir los valores objetivo de los datos no vistos, dadas las características.\n",
    "\n",
    "        ![](images/paste-2.png){width=\"80%\"}\n",
    "\n",
    "-   Tipos de aprendizaje supervisado\n",
    "\n",
    "    +--------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+\n",
    "    | -   Clasificación: La variable objetivo consta de categorías.            | -   Regresión: La variable objetivo es continua.                                                                                                           |\n",
    "    |                                                                          |                                                                                                                                                            |\n",
    "    |     Ejemplo: Predecir si una transferencia bancaria es fraudulenta o no. |     Ejemplo: Un modelo puede utilizar características como el número de habitaciones y el tamaño de una propiedad para predecir el precio de la propiedad. |\n",
    "    +--------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+\n",
    "\n",
    "-   Convenciones de denominación\n",
    "\n",
    "    -   Característica = variable predictora = variable independiente\n",
    "\n",
    "    -   Variable objetivo = variable dependiente = variable de respuesta\n",
    "\n",
    "-   Antes de utilizar el aprendizaje supervisado\n",
    "\n",
    "    -   Requisitos:\n",
    "        -   Que no falten valores.\n",
    "        -   Que los datos esten en formato numérico.\n",
    "        -   Que los datos esten almacenados en un DataFrame de pandas o en una matriz de Numpy.\n",
    "    -   Hay que realizar primero un análisis exploratorio de datos (AED)\n",
    "\n",
    "-   Sintaxis de scikit-learn\n",
    "\n",
    "    -   Scikit-learn sigue la misma sintaxis para todos los modelos de aprendizaje supervisado lo que hace que el flujo de trabajo sea reproducible."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "ac012c5b",
   "metadata": {},
   "outputs": [],
   "source": [
    "#| echo: true\n",
    "#| eval: false\n",
    "from sklearn.module import Model\n",
    "model = Model()\n",
    "model.fit(X, y)\n",
    "predictions = model.predict(X_new)\n",
    "print(predictions)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "fb40c6fa",
   "metadata": {},
   "source": [
    "![](images/paste-3.png)\n",
    "\n",
    "### Clasificación binaria\n",
    "\n",
    "Hay dos tipos de aprendizaje supervisado: clasificación y regresión. La clasificación binaria se utiliza para predecir una variable objetivo que solo tiene dos etiquetas, normalmente representados numéricamente con un cero o un uno.\n",
    "\n",
    "A continuación se muestra la página `.head()` de un conjunto de datos `churn_df`. Puedes esperar que el resto de los datos contengan valores similares.\n",
    "\n",
    "![](images/paste-4.png)\n",
    "\n",
    "Observando estos datos, ¿Qué columna podría ser la variable objetivo de la clasificación binaria?\n",
    "\n",
    "**Respuestas posibles**\n",
    "\n",
    "-   [ ] \"`customer_service_calls`\"\n",
    "\n",
    "-   [ ] \"`total_night_charge`\"\n",
    "\n",
    "-   [x] \"`churn`\"\n",
    "\n",
    "-   [ ] \"`account_lenght`\"\n",
    "\n",
    "`churn` tiene valores de `0` y `1`, por lo que se puede predecir utilizando un modelo de clasificación binaria.\n",
    "\n",
    "### El flujo de trabajo del aprendizaje supervisado\n",
    "\n",
    "Recuerda que sckikit-learn ofrece un flujo de trabajo repetible para utilizar modelos de aprendizaje supervisado con el fin de predecir los valores de la variable objetivo cuando se presentan nuevos datos.\n",
    "\n",
    "Reordena el pseudocódigo proporcionado para que represente con precisión el flujo de trabajo de construir un modelo de aprendizaje supervisado y hacer predicciones.\n",
    "\n",
    "#### Instrucciones\n",
    "\n",
    "-   Arrastra los bloques de código en el orden correcto para representar cómo se ejecutaría el flujo de trabajo de aprendizaje supervisado.\n",
    "\n",
    "    ![](images/paste-5.png){width=\"80%\"}\n",
    "\n",
    "Puedes ver cómo scikit-learn permite hacer predicciones ¡con solo unas pocas líneas de código!\n",
    "\n",
    "## El reto de la clasificación\n",
    "\n",
    "-   Clasificar etiquetas de datos no vistos\n",
    "\n",
    "1.  Se construye un modelo.\n",
    "\n",
    "2.  El modelo aprende de los datos etiquetados que le pasamos.\n",
    "\n",
    "3.  Le pasamos datos no etiquetados al modelo como entrada.\n",
    "\n",
    "4.  El modelo predice las etiquetas de los datos no vistos.\n",
    "\n",
    "    -   Datos etiquetados = datos de entrenamiento\n",
    "\n",
    "-   K vecinos más cercanos (KNN)\n",
    "    -   Predecir la etiqueta de un punto de datos:\n",
    "        -   Observando los `k` puntos de datos etiquetados más cercanos.\n",
    "        -   Utilizando el voto por mayoría.\n",
    "\n",
    "|                           |                           |\n",
    "|---------------------------|---------------------------|\n",
    "| si k = 3                  | si k = 5                  |\n",
    "| ![](images/paste-7.png)   | ![](images/paste-9.png)   |\n",
    "| Se clasificaría como roja | Se clasificaría como azul |\n",
    "\n",
    "-   Intuición KNN\n",
    "\n",
    "    Se muestra un gráfico de dispersión que muestra la tarifa nocturna total frente a la tarifa diaria total de los clientes de una empresa de telecomunicaciones. Azul representa a los clientes que se han dado de baja y los de rojo a los que no.\n",
    "\n",
    "    |                          |                          |\n",
    "    |--------------------------|--------------------------|\n",
    "    | ![](images/paste-10.png) | ![](images/paste-11.png) |\n",
    "\n",
    "    KNN crea un límite de decisión para predecir si los clientes se darán de baja. Se prevee que los clientes en la franja con fondo gris, se darán de baja.\n",
    "\n",
    "-   Utilizar scikit-learn para ajustar un clasificador"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "a59a4a7b",
   "metadata": {
    "md-indent": "    "
   },
   "outputs": [],
   "source": [
    "#| echo: true\n",
    "#| eval: false\n",
    "from sklearn.neighbors import KNeighborsClassifier\n",
    "X = churn_df[[\"total_day_charge\", \"total_eve_charge\"]].values\n",
    "y = churn_df[\"churn\"].values\n",
    "print(X.shape, y.shape)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "86fe8874",
   "metadata": {},
   "source": [
    "    ![](images/paste-13.png)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "3edca306",
   "metadata": {
    "md-indent": "    "
   },
   "outputs": [],
   "source": [
    "#| echo: true\n",
    "#| eval: false\n",
    "knn = KNeighborsClassifier(n_neighbors=15)\n",
    "knn.fit(X, y)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "52d60636",
   "metadata": {},
   "source": [
    "-   Predecir con datos no etiquetados"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "c9dd1c23",
   "metadata": {},
   "outputs": [],
   "source": [
    "#| echo: true\n",
    "#| eval: false\n",
    "X_new = np.array([[56.8, 17.5],\n",
    "                  [24.4, 24.1],\n",
    "                  [50.1, 10.9]])\n",
    "\n",
    "print(X_new.shape)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "20b1bd6d",
   "metadata": {},
   "source": [
    "![](images/paste-14.png)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "283e73c4",
   "metadata": {},
   "outputs": [],
   "source": [
    "#| echo: true\n",
    "#| eval: false\n",
    "predictions = knn.predict(X_new)\n",
    "print('Predictions: {}' .format(predictions))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b7a76f5f",
   "metadata": {},
   "source": [
    "![](images/paste-15.png)\n",
    "\n",
    "### Ajustar KNN: k vecinos más cercanos\n",
    "\n",
    "En este ejercicio, construirás tu primer modelo de clasificación utilizando el conjunto de datos `churn_df`, que se ha precargado para el resto del capítulo. \n",
    "\n",
    "El objetivo, `churn` tiene que ser una sola columna con el mismo múmero de observaciones que los datos de las características. Los datos de las características ya se han convertido en matrices `numpy`.\n",
    "\n",
    "\"`account_length`\" y \"`costumer_service_calls`\" se tratan como características porque la duración de la cuenta indica fidelidad del cliente, las llamadas frecuentes al servicio de atención al cliente pueden ser señal de insatisfacción y ambas pueden ser buenos predictores de la rotación.\n",
    "\n",
    "#### Instrucciones\n",
    "\n",
    "- Importa `KNeighborsClassifier` desde `sklearn.neighbors`.\n",
    "- Instncia un `KNeighborsClassifier` llamado `knn` con `6` vecinos.\n",
    "- Ajusta el clasificador a los datos utilizando el método `.fit()`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "2ef5b6e0",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>account_length</th>\n",
       "      <th>total_day_charge</th>\n",
       "      <th>total_eve_charge</th>\n",
       "      <th>total_night_charge</th>\n",
       "      <th>total_intl_charge</th>\n",
       "      <th>customer_service_calls</th>\n",
       "      <th>churn</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>101</td>\n",
       "      <td>45.85</td>\n",
       "      <td>17.65</td>\n",
       "      <td>9.64</td>\n",
       "      <td>1.22</td>\n",
       "      <td>3</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>73</td>\n",
       "      <td>22.30</td>\n",
       "      <td>9.05</td>\n",
       "      <td>9.98</td>\n",
       "      <td>2.75</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>86</td>\n",
       "      <td>24.62</td>\n",
       "      <td>17.53</td>\n",
       "      <td>11.49</td>\n",
       "      <td>3.13</td>\n",
       "      <td>4</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>59</td>\n",
       "      <td>34.73</td>\n",
       "      <td>21.02</td>\n",
       "      <td>9.66</td>\n",
       "      <td>3.24</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>129</td>\n",
       "      <td>27.42</td>\n",
       "      <td>18.75</td>\n",
       "      <td>10.11</td>\n",
       "      <td>2.59</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   account_length  total_day_charge  total_eve_charge  total_night_charge  \\\n",
       "0             101             45.85             17.65                9.64   \n",
       "1              73             22.30              9.05                9.98   \n",
       "2              86             24.62             17.53               11.49   \n",
       "3              59             34.73             21.02                9.66   \n",
       "4             129             27.42             18.75               10.11   \n",
       "\n",
       "   total_intl_charge  customer_service_calls  churn  \n",
       "0               1.22                       3      1  \n",
       "1               2.75                       2      0  \n",
       "2               3.13                       4      0  \n",
       "3               3.24                       1      0  \n",
       "4               2.59                       1      0  "
      ]
     },
     "execution_count": 1,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import pandas as pd\n",
    "\n",
    "ruta = './data/churn_df.csv'\n",
    "churn_df = pd.read_csv(ruta)\n",
    "churn_df.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "10169b91",
   "metadata": {},
   "source": [
    "### Predecir KNN: k vecinos más cercanos\n",
    "\n",
    "## Medir el rendimiento del modelo\n",
    "\n",
    "### División entrenamiento/prueba + cálculo de precisión\n",
    "\n",
    "### Sobreajuste e infraajuste\n",
    "\n",
    "### Visualizar la complejidad del modelo"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3",
   "path": "/Users/macbookairedwin/Documents/Datacamp/fundamentos-aprendizaje-automatico-python/.venv/share/jupyter/kernels/python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.13.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
